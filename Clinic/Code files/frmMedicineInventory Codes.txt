Option Explicit

Dim cn As ADODB.Connection
Dim rs As ADODB.Recordset


Private Sub cmdAdd_Click()
    frmOrderMedicine.txtMedID.Text = GetNextMedID
    frmOrderMedicine.Show
End Sub

Private Sub cmdOrder_Click()
    If txtMedID.Text = "" Then
        MsgBox "Select a record first.", vbExclamation
        Exit Sub
    End If

    frmOrderMedicine.txtMedID.Text = txtMedID.Text
    frmOrderMedicine.txtMedName.Text = txtMedName.Text
    frmOrderMedicine.txtManufacturer.Text = txtManufacturer.Text
    
    frmOrderMedicine.Show vbModal
End Sub

Private Sub Form_Load()
    Set cn = New ADODB.Connection
    cn.Open "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & _
            App.Path & "\ClinicRecord.mdb"

    txtMedID.Locked = True
End Sub

Private Function GetNextMedID() As Long
    Set rs = New ADODB.Recordset

    rs.CursorLocation = adUseClient
    rs.Open "SELECT MAX(MedID) AS MaxID FROM medicine_master", cn, _
              adOpenForwardOnly, adLockReadOnly

    If rs.EOF Or IsNull(rs!MaxID) Then
        GetNextMedID = 1
    Else
        GetNextMedID = rs!MaxID + 1
    End If

    rs.Close
    Set rs = Nothing
End Function

Public Sub LoadData()
    Set rs = New ADODB.Recordset
    rs.CursorLocation = adUseClient

    rs.Open "SELECT MedID, MedName, Manufacturer, StockQty, " & _
            "IIF(StockQty <= 10, 'LOW', 'OK') AS AlertStatus " & _
            "FROM medicine_master ORDER BY MedID ASC", _
            cn, adOpenStatic, adLockReadOnly

    Set DGMedicine.DataSource = rs
End Sub

Private Sub cmdDelete_Click()
    If txtMedID.Text = "" Then
        MsgBox "Select a record first.", vbExclamation
        Exit Sub
    End If

    If MsgBox("Delete this medicine?", vbYesNo + vbCritical) = vbYes Then
        cn.Execute "DELETE FROM medicine_master WHERE MedID=" & txtMedID.Text
        MsgBox "Deleted successfully!", vbInformation
         Clear
        LoadData
    End If
End Sub

Private Sub DGMedicine_RowColChange(LastRow As Variant, ByVal LastCol As Integer)
    If DGMedicine.ApproxCount = 0 Then Exit Sub

    txtMedID.Text = DGMedicine.Columns(0).Text
    txtMedName.Text = DGMedicine.Columns(1).Text
    txtManufacturer.Text = DGMedicine.Columns(2).Text
    txtQty.Text = DGMedicine.Columns(3).Text
    txtAlertStatus.Text = DGMedicine.Columns(4).Text
    If txtAlertStatus.Text = "LOW" Then
        MsgBox "Warning: Stock for this medicine is LOW!", vbExclamation, "Low Stock Alert"
    End If
End Sub

Private Sub cmdClear_Click()
    Call Clear
End Sub

Private Sub Clear()
    txtMedID.Text = ""
    txtMedName.Text = ""
    txtManufacturer.Text = ""
    txtQty.Text = ""
End Sub

Private Sub cmdLoad_Click()
    Call LoadData
End Sub

Private Sub cmdClose_Click()
    Unload Me
End Sub

